### Анализ данных финтех-стартапа.

### Описание задачи
Сбор данных по транзакционной активности пользователей и настройка обновления таблицы с курсом валют. 
Цель — понять, как выглядит динамика оборота всей компании и что приводит к его изменениям. 

### Вводные к проекту
Необходимо реализовать пайплайн обработки данных из нескольких источников и полноценное хранилище для финтех-стартапа.
Выгрузка данных из S3 в DWH с помощью DAG в Airflow: обработка информации в рамках ETL-процесса.
Хранилище в компании должно быть реализовано на Vertica. После построения пайплайна обработки данных необходимо отдельно реализовать пайплайн формирования витрины с помощью Airflow и DAG. Необходимо также реализовать BI-аналитику для компании: подключиться из Metabase к Vertica и реализовать дашборд.
	
### Входные данные	
Данные `transactions` содержат в себе информацию о движении денежных средств между клиентами в разных валютах.
Структура данных:
- `operation_id` — id транзакции;
- `account_number_from` — внутренний бухгалтерский номер счёта транзакции ОТ КОГО;
- `account_number_to` — внутренний бухгалтерский номер счёта транзакции К КОМУ;
- `currency_code` — трёхзначный код валюты страны, из которой идёт транзакция;
- `country` — страна-источник транзакции;
- `status` — статус проведения транзакции: `queued` («транзакция в очереди на обработку сервисом»), `in_progress` («транзакция в обработке»), `blocked` («транзакция заблокирована сервисом»), `done` («транзакция выполнена успешно»), `chargeback` («пользователь осуществил возврат по транзакции»).
- `transaction_type` — тип транзакции во внутреннем учёте: `authorisation` («авторизационная транзакция, подтверждающая наличие счёта пользователя»), `sbp_incoming` («входящий перевод по системе быстрых платежей»), `sbp_outgoing` («исходящий перевод по системе быстрых платежей»), `transfer_incoming` («входящий перевод по счёту»), `transfer_outgoing` («исходящий перевод по счёту»), `c2b_partner_incoming` («перевод от юридического лица»), `c2b_partner_outgoing` («перевод юридическому лицу»).
- `amount` — целочисленная сумма транзакции в минимальной единице валюты страны (копейка, цент, куруш);
- `transaction_dt` — дата и время исполнения транзакции до миллисекунд.

### Источники данных
Бакет в S3.

Данные подготовлены и доступны для чтения в специальном бакете в S3: https://storage.yandexcloud.net/final-project/. Данные выгружены батчами: необходимо обрабатывать каждый файл итеративно при запуске ETL-процесса. История изменения курсов валют лежит в `currencies_history.csv`, а история транзакций — в батчах `transactions_batch_*.csv`.
Данные по транзакциям `transactions_batch_*.csv` отсортированы по времени с 01.10.2022 и далее, при этом разбиты по возрастающим батчам на 10 частей.

Подключение к данным в S3 осуществляется через библиотеку `boto3`. 

### Инструкция по выполнению проекта
Архитектура итогового решения:
![image](https://pictures.s3.yandex.net/resources/Frame_188_1671620037.png)

#### Шаг 1. Изучение входных данных
Проверьте подключение к источнику. Убедитесь, что данные доступны в указанных схемах с помощью IDE.
Изучите структуру данных, а также проверьте, что данные полные, и при работе с информацией не выпадает ошибка.

#### Шаг 2. Создание таблиц для хранилища
Подготовьте инфраструктуру для загрузки сырых данных в схемы `*__STAGING` и `*__DWH` в Vertica и в витрину — создайте нужные таблицы.
Создайте таблицы `transactions` и `currencies` для загрузки сырых данных согласно модели данных:
  - a. Реализуйте соответствующую слою сырых данных модель данных полей — присвойте им нужные имена, типы данных.
  - b. Создайте проекции по датам.
  - c. Добавьте сортировку и сегментирование по хеш-функции от даты и идентификатора транзакции.
  
Создайте витрину `global_metrics` с агрегацией по дням. 
Витрина должна помогать отвечать на такие вопросы:
  - какая ежедневная динамика сумм переводов в разных валютах;
  - какое среднее количество транзакций на пользователя;
  - какое количество уникальных пользователей совершают транзакции в валютах;
  - какой общий оборот компании в единой валюте.
  
Для этого включите в витрину такие поля:
  - `date_update` — дата расчёта,
  - `currency_from` — код валюты транзакции;
  - `amount_total` — общая сумма транзакций по валюте в долларах;
  - `cnt_transactions` — общий объём транзакций по валюте;
  - `avg_transactions_per_account` — средний объём транзакций с аккаунта;
  - `cnt_accounts_make_transactions` — количество уникальных аккаунтов с совершёнными транзакциями по валюте.
Сделайте так, чтобы витрина обновлялась ежедневно инкрементом на основании данных из таблиц transactions и currencies. Каждый день должна добавляться новая запись за вчера.

#### Шаг 3. Пайплайн загрузки данных из систем-источников в staging-слой
Вам нужно создать пайплайн для ежедневной выгрузки данных из выбранного источника и загрузки в staging-слой хранилища в Vertica через DAG в Airflow (выгрузка из S3).

#### Шаг 4. Пайплайн обновления витрины данных
Теперь вам нужно настроить пайплайн переноса данных из слоя `staging` в созданную ранее витрину.
Создайте DAG в Airflow, который будет наполнять итоговую витрину в схеме `*__DWH` хранилища. В рамках пайплайна реализуйте:
  - a. очистку от тестовых аккаунтов (аккаунты < 0).
  - b. ежедневное инкрементальное добавление новой партицию данных по дате за вчерашний день.
  - c. расчёт агрегатов должен быть в соответствии с установленными требованиями по названию и содержанию полей итоговой витрины `global_metrics`.
Запустите пайплайн за выбранный период (октябрь 2022 года), задавая параметр даты: каждый день пайплайн должен отработать самостоятельно.

#### Шаг 5. Создание дашборда
Подключите Metabase к витрине и реализуйте интерактивный отчёт для команды аналитиков. 
Подключите Metabase к схеме `*__DWH` в Vertica.
Настройте интеграцию с данными в `global_metrics`.
Соберите автобновляемый дашборд:
  - a. Визуализируйте метрику суммы переводов с возможностью смотреть общую сумму и выбирать отдельные валюты через фильтр.
  - b. Визуализируйте метрику среднего объема транзакций на пользователя.
  - c. Визуализируйте метрику количества уникальных пользователей, которые совершают транзакции в валютах.
  - d. Визуализируйте метрику общего оборота компании в единой валюте.
  - e. Настройте фильтры по дате и выбранным валютам перевода.
